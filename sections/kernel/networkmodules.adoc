= Disable unused network protocols

== Description

The kernel supports multiple protocols that might not be in use
by the system.

== Rationale

If the protocols are not needed, they should be disabled, reducing
the potential attack surface.

== Audit

[source,shell]
----
@test "Verify that kernel module dccp is disabled" {
  run bash -c "grep 'install dccp /bin/true' /etc/modprobe.d/disablenet.conf"
  [ "$status" -eq 0 ]
}
----

[source,shell]
----
@test "Verify that kernel module sctp is disabled" {
  run bash -c "grep 'install sctp /bin/true' /etc/modprobe.d/disablenet.conf"
  [ "$status" -eq 0 ]
}
----

[source,shell]
----
@test "Verify that kernel module rds is disabled" {
  run bash -c "grep 'install rds /bin/true' /etc/modprobe.d/disablenet.conf"
  [ "$status" -eq 0 ]
}
----

[source,shell]
----
@test "Verify that kernel module tipc is disabled" {
  run bash -c "grep 'install tipc /bin/true' /etc/modprobe.d/disablenet.conf"
  [ "$status" -eq 0 ]
}
----

== Remediation

=== shell

[source,shell]
----
  NET="dccp sctp rds tipc"
  for disable in $NET; do
    if ! grep -q "$disable" /etc/modprobe.d/disablenet.conf 2> /dev/null; then
      echo "install $disable /bin/true" >> /etc/modprobe.d/disablenet.conf
    fi
  done
----

=== Ansible

[source,py]
----
- name: disablenet.conf
  become: yes
  become_method: sudo
  file:
    state: touch
    path: /etc/modprobe.d/disablenet.conf
    owner: root
    group: root
    mode: 0644

- name: disable kernel network modules
  become: yes
  become_method: sudo
  lineinfile:
    dest: /etc/modprobe.d/disablenet.conf
    line: "install {{ item }} /bin/true"
  with_items:
    - dccp
    - sctp
    - rds
    - tipc
  tags:
    - modprobe
    - security
----

== References
